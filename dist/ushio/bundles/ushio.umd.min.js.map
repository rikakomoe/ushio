{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://ushio/lib/ushio.service.ts","ng://ushio/lib/ushio.component.ts","ng://ushio/lib/ushio.module.ts"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__values","o","m","UshioI18nProvider","lang","i18nSource","en","speed","normal","loop","noLoop","fullscreen","exitFullscreen","statistic","language","mute","zh-Hans","_b","tslib_1.__values","navigator","languages","_c","langCode","setLanguage","bind","defineProperty","entries","map","entry","key","UshioService","timeStampRegex","i18n","version","build","parseSubtitles","input","str","_this","origin","trim","replace","split","splitSubtitles","cachedSubtitle","state","forEach","line","match","exec","startTime","endTime","texts","Error","processLine","Injectable","args","providedIn","UshioSource","Directive","selector","Input","UshioSubtitles","UshioComponent","element","sanitization","service","mInjectedStyles","preload","mSources","sources","playingSource","mSubtitles","subtitles","flyingSubtitles","mVolume","volumeChange","EventEmitter","mPlaybackRate","playbackRateChange","mVolumeControl","mSourceControl","mSubtitlesControl","mSettingsControl","mLoopControl","mFullscreenControl","subtitlesSlotUpdate$","Subject","sourcesSlotUpdate$","subtitlesSlotChange$","asObservable","pipe","distinctUntilChanged","sourcesSlotChange$","mobileShowControlStateChange$","interactMode","focus","mShowControl","thumbMouseDown","controlMouseDown","controlHoveredClass","showContextMenu","showStatisticInfoPanel","showVolumeHint","showProgressDetail","showControlChange","mPaused","pausedChange","mCurrentTime","currentTimeChange","duration","durationChange","bufferedTime","waiting","waitingChange","loopChange","mutedChange","fps","fpsStart","fpsIndex","panelTranslations","settings","source","mContextMenuPosition","mProgressDetailPosition","mProgressDetailContainerPosition","mProgressDetailTimePosition","mProgressDetailPositionRate","contextMenuState","subscriptions","showLangMenu","onComponentClicked","onDocumentClicked","style","bypassSecurityTrustHtml","mSrc","src","updateSources","filter","enabled","volume","video","nativeElement","muted","Math","round","playbackRate","volumeControl","setAllControlPanelsPosition","sourceControl","subtitlesControl","settingsControl","loopControl","fullscreenControl","document","fullscreenElement","mouseDown","enabledSubtitles","isFullScreen","paused","pause","play","currentTime","formatDuration","bypassSecurityTrustStyle","volume100","mapSpeedToProgress","height","videoHeight","videoWidth","thumbnails","ceil","toFixed","mapProgressToSpeed","progress","floor","h","ngOnInit","ngAfterContentInit","mapPropsToObject","props","fn","sourceObj","reduce","agg","cur","_a","onContentChildrenOrSlotChanged$","attr","contentChildren","slotChange$","contentChildrenMap","obj","slotMap","getAttribute","merge","of","toArray","changes","contents","subtitlesChange$","subtitlesContentChildren","subscribe","updateSubtitles","sourcesChange$","sourceContentChildren","ngAfterViewInit","mouseMove$","fromEvent","mouseUp$","touchMove$","touchStart$","touchEnd$","mouseTouchUp$","ifMouseInArea","btnElement","popUpElement","rect1","getBoundingClientRect","rect2","clientX","left","right","clientY","top","bottom","desktopShowControlStateChange$","rect","showControl","delaySwitch","showControlStateChange$","switchMap","timer","mapTo","NEVER","mouseHoverProgressState$","slider","yCenter","abs","containerLeft","width","timeLeft","emit","subscribeTimeUpdate","timeUpdate","updateFlyingSubtitles","timeRanges","end","start","buffered","mapToRate","total","moveEvent","eventCoordinate","TouchEvent","changedTouches","onMouseTouchDown$","onMouseTouchDrag$","concatMap","takeUntil","thumbMouseTouchDown$","thumbTouchDrag$","unsubscribe","btns","controlHoverStateChange$","volumeBtn","volumePanel","btnName","settingsBtn","settingsPanel","sourceBtn","sourcePanel","subtitlesBtn","subtitlesPanel","btns_1","btns_1_1","btn","subscribeControlHoveredChange","controlHoveredChange","hoverStateChange$","volumeMouseTouchDown$","volumeBar","volumeTouchDrag$","speedMouseTouchDown$","speedBar","speedTouchDrag$","onKeyDown$","code","tap","preventDefault","stopPropagation","togglePlay","showVolumeHint$","dismissVolumeHint$","outer","panel","contextMenu","langContextMenuOption","addEventListener","animationFrame$","animationFrameScheduler","repeat","Date","fpsCurrent","ngOnDestroy","sub","removeEventListener","shortName","name","default","type","undefined","sm_1","shortname","values","indexOfDefault","findIndex","parsedSubtitles","text","fetch","_d","parsed","class","srclang","toLowerCase","console","warn","error","flyingSubtitlesTrack","subtitle","setTimeout","loopBtn","loopPanel","fullScreenBtn","fullScreenPanel","item","setPanelPosition","outerRect","panelRect","btnRect","onSlotChange","target","assignedNodes","node","nodeName","innerHTML","onVideoMaskClicked","onSelectSource","load","onCheckSubtitles","toggleMute","random","toggleLoop","toggleFullscreen","requestFullscreen","toggleShowStatisticInfoPanel","Component","template","encapsulation","ViewEncapsulation","ShadowDom","ElementRef","DomSanitizer","Output","ViewChild","static","ContentChildren","UshioModule","NgModule","declarations","imports","CommonModule","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable } from '@angular/core'\n\nexport interface ISubtitle {\n  startTime: number\n  endTime: number\n  texts: string[]\n}\n\nclass UshioI18nProvider {\n  private lang = 'en'\n  private readonly i18nSource = {\n    en: {\n      lang: 'English',\n      speed: 'Speed',\n      normal: 'Normal',\n      loop: 'Loop',\n      noLoop: 'No Loop',\n      fullscreen: 'Fullscreen',\n      exitFullscreen: 'Exit fullscreen',\n      statistic: 'Video statistic',\n      language: 'Language',\n      mute: 'Mute'\n    },\n    'zh-Hans': {\n      lang: 'ç®ä½ä¸­æ',\n      speed: 'æ­æ¾éåº¦',\n      normal: 'æ­£å¸¸',\n      loop: 'å¾ªç¯æ­æ¾',\n      noLoop: 'å³é­å¾ªç¯',\n      fullscreen: 'å¨å±æ­æ¾',\n      exitFullscreen: 'éåºå¨å±',\n      statistic: 'è§é¢ç»è®¡ä¿¡æ¯',\n      language: 'è¯­è¨',\n      mute: 'éé³'\n    }\n  }\n  get languages () {\n    return Object.entries(this.i18nSource).map(entry => [entry[0], entry[1].lang])\n  }\n  get language () {\n    return this.lang\n  }\n\n  constructor () {\n    for (const langCode of navigator.languages) {\n      if (this.setLanguage(langCode)) break\n    }\n    this.t = this.t.bind(this)\n  }\n\n  setLanguage (langCode): boolean {\n    if (this.i18nSource[langCode]) {\n      this.lang = langCode\n      return true\n    }\n    return false\n  }\n\n  t (key: string): string {\n    return this.i18nSource[this.lang][key]\n  }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class UshioService {\n\n  static version = '4.0.0'\n  static build = 'NG Build'\n\n  // tslint:disable-next-line:max-line-length\n  private readonly timeStampRegex = /^(?:(\\d{2,})(:))?([0-5][0-9])(:)([0-5][0-9])([,.])(\\d{3})( --> )(?:(\\d{2,})(:))?([0-5][0-9])(:)([0-5][0-9])([,.])(\\d{3})/\n  i18n = new UshioI18nProvider()\n  get version () {\n    return UshioService.version\n  }\n  get build () {\n    return UshioService.build\n  }\n\n  constructor () { }\n\n  parseSubtitles (input: string): ISubtitle[] {\n    const trim = (str: string) => str.trim()\n      .replace(/^[^\\S\\n]+/gm, '')\n      .replace(/\\u0000/g, '\\uFFFD')\n      .replace(/\\r\\n/g, '\\n')\n      .replace(/\\r/g, '\\n')\n      .replace(/\\n{3,}/g, '\\n\\n')\n    const origin = trim(input)\n      .split('\\n')\n    const splitSubtitles: ISubtitle[] = []\n    let cachedSubtitle: ISubtitle | null = null\n    let state = 'root'\n    const processLine = (line: string) => {\n      switch (state) {\n        case 'note':\n        /* falls through */\n        case 'title':\n          if (line === '') {\n            state = 'root'\n          }\n          return\n        case 'root':\n          if (line.match(/^WEBVTT/)) {\n            state = 'title'\n            return\n          } else if (line.match(/^NOTE/)) {\n            state = 'note'\n            return\n          } else if (line === '') return [line]\n          else if (!line.match(/-->/)) {\n            state = 'timeline'\n            return\n          }\n        /* falls through */\n        case 'timeline':\n          const match = this.timeStampRegex.exec(line)\n          if (match) {\n            cachedSubtitle = {\n              startTime: 1000 * (60 * (60 * +match[1] + +match[3]) + +match[5]) + +match[7] || 0,\n              endTime: 1000 * (60 * (60 * +match[9] + +match[11]) + +match[13]) + +match[15] || 0,\n              texts: []\n            }\n            state = 'text'\n            return\n          } else {\n            throw new Error(`unexpected timeline token: ${line}`)\n          }\n        case 'text':\n          if (line === '') {\n            state = 'root'\n            if (cachedSubtitle) {\n              splitSubtitles.push(cachedSubtitle)\n              cachedSubtitle = null\n            }\n          } else if (cachedSubtitle) {\n            cachedSubtitle.texts.push(line)\n          }\n      }\n    }\n    origin.forEach(line => processLine(line))\n    if (cachedSubtitle) splitSubtitles.push(cachedSubtitle)\n    return splitSubtitles\n  }\n\n}\n","import {\n  AfterContentInit,\n  AfterViewInit,\n  Component,\n  ContentChildren,\n  Directive,\n  ElementRef, EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit, Output,\n  QueryList,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core'\nimport { DomSanitizer, SafeStyle } from '@angular/platform-browser'\nimport {\n  animationFrameScheduler,\n  fromEvent, merge, NEVER, Observable, of,\n  Subject, Subscription, timer\n} from 'rxjs'\nimport {\n  concatMap, distinctUntilChanged,\n  filter, map, mapTo, repeat, switchMap, takeUntil, tap\n} from 'rxjs/operators'\n\nimport { ISubtitle, UshioService } from './ushio.service'\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: 'ushio-source'\n})\nexport class UshioSource {\n  @Input() src!: string\n  @Input() type: string\n  @Input() shortname: string\n  @Input() name: string\n  @Input() default: boolean\n}\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: 'ushio-subtitles'\n})\nexport class UshioSubtitles {\n  @Input() value: string\n  @Input() src: string\n  @Input() type: string\n  @Input() name: string\n  @Input() class: string\n  @Input() srclang: string\n  @Input() default: boolean\n}\n\ninterface Source {\n  shortName: string\n  name: string\n  sources: {\n    src: string;\n    type: string;\n  }[]\n  default?: boolean\n}\n\ninterface Subtitles {\n  name: string\n  class: string\n  parsedSubtitles: ISubtitle[]\n  enabled: boolean\n}\n\n@Component({\n  selector: 'ushio-player',\n  templateUrl: './ushio.component.html',\n  styleUrls: ['./ushio.component.styl'],\n  encapsulation: ViewEncapsulation.ShadowDom\n})\nexport class UshioComponent implements OnInit, AfterContentInit, AfterViewInit, OnDestroy {\n\n  private mInjectedStyles = []\n  get injectedStyles () {\n    return this.mInjectedStyles.map(\n      style => this.sanitization.bypassSecurityTrustHtml(`\n      <style>\n       ${style}\n      </style>\n    `))\n  }\n\n  @Input() set src (src) {\n    this.mSrc = src\n    this.updateSources()\n  }\n  get src () {\n    return this.mSrc\n  }\n  @Input() poster\n  @Input() crossorigin\n  @Input() autoplay\n  @Input() preload = 'metadata'\n  @Input() set lang (lang: string) {\n    this.service.i18n.setLanguage(lang)\n  }\n  @Input() thumbnails\n\n  private mSrc\n  private mSources = []\n  sources: Source[] = []\n  playingSource = 0\n\n  private mSubtitles = []\n  subtitles: Subtitles[] = []\n  get enabledSubtitles () {\n    return this.subtitles.filter(s => s.enabled)\n  }\n  flyingSubtitles: Subtitles[] = []\n\n  private mVolume = 1\n  @Input() set volume (volume) {\n    this.video.nativeElement.volume = volume\n  }\n  get volume100 () {\n    if (this.video.nativeElement.muted) return 0\n    return Math.round(this.mVolume * 100)\n  }\n  @Output() volumeChange = new EventEmitter<number>()\n\n  private mPlaybackRate = 1\n  @Input() set playbackRate (playbackRate) {\n    this.video.nativeElement.playbackRate = playbackRate\n  }\n  @Output() playbackRateChange = new EventEmitter<number>()\n\n  private mVolumeControl = true\n  @Input() set volumeControl (volumeControl) {\n    this.mVolumeControl = volumeControl\n    this.setAllControlPanelsPosition()\n  }\n  get volumeControl () {\n    return this.mVolumeControl\n  }\n  private mSourceControl = true\n  @Input() set sourceControl (sourceControl) {\n    this.mSourceControl = sourceControl\n    this.setAllControlPanelsPosition()\n  }\n  get sourceControl () {\n    return this.mSourceControl\n  }\n  private mSubtitlesControl = true\n  @Input() set subtitlesControl (subtitlesControl) {\n    this.mSubtitlesControl = subtitlesControl\n    this.setAllControlPanelsPosition()\n  }\n  get subtitlesControl () {\n    return this.mSubtitlesControl\n  }\n  private mSettingsControl = true\n  @Input() set settingsControl (settingsControl) {\n    this.mSettingsControl = settingsControl\n    this.setAllControlPanelsPosition()\n  }\n  get settingsControl () {\n    return this.mSettingsControl\n  }\n  private mLoopControl = true\n  @Input() set loopControl (loopControl) {\n    this.mLoopControl = loopControl\n    this.setAllControlPanelsPosition()\n  }\n  get loopControl () {\n    return this.mLoopControl\n  }\n  private mFullscreenControl = true\n  @Input() set fullscreenControl (fullscreenControl) {\n    this.mFullscreenControl = fullscreenControl\n    this.setAllControlPanelsPosition()\n  }\n  get fullscreenControl () {\n    return this.mFullscreenControl\n  }\n\n  @ViewChild('video', { static: true }) video\n  @ViewChild('slider', { static: true }) slider\n  @ViewChild('volumeBar', { static: true }) volumeBar\n  @ViewChild('volumePanel', { static: true }) volumePanel\n  @ViewChild('volumeBtn', { static: true }) volumeBtn\n  @ViewChild('settingsPanel', { static: true }) settingsPanel\n  @ViewChild('settingsBtn', { static: true }) settingsBtn\n  @ViewChild('speedBar', { static: true }) speedBar\n  @ViewChild('sourcePanel', { static: true }) sourcePanel\n  @ViewChild('sourceBtn', { static: true }) sourceBtn\n  @ViewChild('subtitlesPanel', { static: true }) subtitlesPanel\n  @ViewChild('subtitlesBtn', { static: true }) subtitlesBtn\n  @ViewChild('loopBtn', { static: true }) loopBtn\n  @ViewChild('loopPanel', { static: true }) loopPanel\n  @ViewChild('fullScreenBtn', { static: true }) fullScreenBtn\n  @ViewChild('fullScreenPanel', { static: true }) fullScreenPanel\n  @ViewChild('contextMenu', { static: true }) contextMenu\n  @ViewChild('langContextMenuOption', { static: true }) langContextMenuOption\n\n  @ContentChildren(UshioSource) sourceContentChildren!: QueryList<UshioSource>\n  @ContentChildren(UshioSubtitles) subtitlesContentChildren!: QueryList<UshioSubtitles>\n  private subtitlesSlotUpdate$ = new Subject<HTMLElement[]>()\n  private sourcesSlotUpdate$ = new Subject<HTMLElement[]>()\n  private subtitlesSlotChange$ = this.subtitlesSlotUpdate$.asObservable().pipe(distinctUntilChanged())\n  private sourcesSlotChange$ = this.sourcesSlotUpdate$.asObservable().pipe(distinctUntilChanged())\n  private mobileShowControlStateChange$ = new Subject<{ showControl: boolean, delaySwitch: boolean }>()\n\n  interactMode: 'desktop' | 'mobile' = 'desktop'\n  private focus = false\n  private mShowControl = false\n  private thumbMouseDown = false\n  private controlMouseDown = false\n  controlHoveredClass = ''\n  private showContextMenu = false\n  private showStatisticInfoPanel = false\n  private showVolumeHint = false\n  private showProgressDetail = false\n  get isFullScreen (): boolean {\n    return document.fullscreenElement !== null\n  }\n  get mouseDown (): boolean {\n    return this.thumbMouseDown || this.controlMouseDown\n  }\n  get showControl () {\n    return !!(this.mShowControl || this.controlHoveredClass || this.mouseDown)\n  }\n  @Output() showControlChange = new EventEmitter<boolean>()\n  get thumbMouseDownClass (): string {\n    return this.thumbMouseDown ? ' thumb-mouse-down' : ''\n  }\n  get pausedClass (): string {\n    return this.mPaused ? ' video-state-pause' : ' video-state-play'\n  }\n  get waitingClass (): string {\n    return this.waiting && !this.mPaused ? ' video-state-waiting' : ''\n  }\n  get mutedClass (): string {\n    return (this.video.nativeElement.muted || this.video.nativeElement.volume === 0)\n      ? ' video-state-muted' : ' video-state-volume'\n  }\n  get loopClass (): string {\n    return this.video.nativeElement.loop ? ' video-state-loop' : ' video-state-noloop'\n  }\n  get subtitleEnabledClass (): string {\n    return this.enabledSubtitles.length > 0 ? ' video-state-subtitles' : ' video-state-nosubtitles'\n  }\n  get fullscreenClass (): string {\n    return this.isFullScreen ? ' video-state-fullscreen' : ' video-state-nofullscreen'\n  }\n  get contextMenuClass (): string {\n    return this.contextMenuState + (this.showContextMenu ? ' active' : '')\n  }\n  get statisticInfoPanelClass (): string {\n    return this.showStatisticInfoPanel ? ' active' : ''\n  }\n  get volumeHintClass (): string {\n    return this.showVolumeHint ? ' active' : ''\n  }\n  get progressDetailClass (): string {\n    return this.showProgressDetail ? ' active' : ''\n  }\n\n  private mPaused = true\n  @Input() set paused (paused) {\n    if (paused) this.video.nativeElement.pause()\n    else this.video.nativeElement.play()\n  }\n  @Output() pausedChange = new EventEmitter<boolean>()\n  private mCurrentTime = 0\n  @Input() set currentTime (currentTime) {\n    this.video.nativeElement.currentTime = currentTime\n  }\n  @Output() currentTimeChange = new EventEmitter<number>()\n  private duration = 0\n  @Output() durationChange = new EventEmitter<number>()\n  private bufferedTime = 0\n  private waiting = false\n  @Output() waitingChange = new EventEmitter<boolean>()\n  @Input() set loop (loop) {\n    this.video.nativeElement.loop = loop\n  }\n  @Output() loopChange = new EventEmitter<boolean>()\n  @Input() set muted (muted) {\n    this.video.nativeElement.muted = muted\n  }\n  @Output() mutedChange = new EventEmitter<boolean>()\n\n  fps = '0.00'\n  private fpsStart = 0\n  private fpsIndex = 0\n\n  get currentTimeStr (): string {\n    return UshioComponent.formatDuration(this.mCurrentTime)\n  }\n  get durationStr (): string {\n    return UshioComponent.formatDuration(this.duration)\n  }\n  get bufferedProgress (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: scaleX(${this.bufferedTime / this.duration})`\n    )\n  }\n  get playedProgress (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: scaleX(${this.mCurrentTime / this.duration})`\n    )\n  }\n  get thumbPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `left: ${this.mCurrentTime / this.duration * 100}%`\n    )\n  }\n  get volumeRate (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: scaleY(${this.volume100 / 100})`\n    )\n  }\n  get volumeThumbPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `bottom: ${this.volume100}%`\n    )\n  }\n  get speedThumbPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `left: ${UshioComponent.mapSpeedToProgress(this.mPlaybackRate)}%`\n    )\n  }\n  private panelTranslations = {\n    settings: 0,\n    source: 0,\n    subtitles: 0,\n    loop: 0,\n    fullscreen: 0\n  }\n  get settingsPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.settings}px - 50%))`\n    )\n  }\n  get sourcePanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.source}px - 50%))`\n    )\n  }\n  get subtitlesPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.subtitles}px - 50%))`\n    )\n  }\n  get loopPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.loop}px - 50%))`\n    )\n  }\n  get fullScreenPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.fullscreen}px - 50%))`\n    )\n  }\n  private mContextMenuPosition = ''\n  get contextMenuPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mContextMenuPosition)\n  }\n  private mProgressDetailPosition = ''\n  private mProgressDetailContainerPosition = ''\n  private mProgressDetailTimePosition = ''\n  private mProgressDetailPositionRate = 0\n  get progressDetailPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mProgressDetailPosition)\n  }\n  get progressDetailContainerPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mProgressDetailContainerPosition)\n  }\n  get progressDetailTimePosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mProgressDetailTimePosition)\n  }\n  get progressDetailImgStyle (): SafeStyle {\n    const height = this.video.nativeElement.videoHeight * 160 / this.video.nativeElement.videoWidth\n    return this.sanitization.bypassSecurityTrustStyle(\n      `height: ${height}px;\n       line-height: ${height}px;\n       background-image: url(\"${this.thumbnails}\");\n       background-position: -${(Math.ceil(this.mProgressDetailPositionRate * 100) - 1) * 160}px 0;`\n    )\n  }\n  get progressDetailTime (): string {\n    return UshioComponent.formatDuration(this.mProgressDetailPositionRate * this.duration)\n  }\n\n  languages = this.service.i18n.languages\n  contextMenuState = 'root'\n  get version () {\n    return this.service.version\n  }\n  get detailedVersion () {\n    return `v${this.service.version} (${this.service.build})`\n  }\n  get videoResolution () {\n    return `${this.video.nativeElement.videoWidth} x ${this.video.nativeElement.videoHeight}`\n  }\n  get videoDuration () {\n    return this.video.nativeElement.duration.toFixed(6)\n  }\n  get videoCurrentTime () {\n    return this.video.nativeElement.currentTime.toFixed(6)\n  }\n\n  private timeUpdate: Subscription\n  private controlHoveredChange: Subscription\n  private subscriptions: Subscription[] = []\n\n  t = this.service.i18n.t\n\n  static mapSpeedToProgress (speed) {\n    if (speed < .5) return 0\n    else if (speed < 1.5) return (speed - .5) * 80\n    else if (speed < 2.0) return 80 + (speed - 1.5) * 40\n    else return 100\n  }\n  static mapProgressToSpeed (progress) {\n    if (progress < .1) return .5\n    else if (progress < .9) return .75 + .25 * Math.floor((progress - 0.1) * 5)\n    else return 2\n  }\n\n  static formatDuration (duration: number) {\n    const h = Math.floor(duration / 3600)\n    const m = Math.floor(duration % 3600 / 60)\n    const s = Math.floor(duration % 60)\n    let str = ''\n    if (h && h < 10) { str += `0${h}:` } else if (h) { str += `${h}:` }\n    if (m < 10) { str += `0${m}:` } else { str += `${m}:` }\n    if (s < 10) { str += `0${s}` } else { str += `${s}` }\n    return str\n  }\n\n  constructor (\n    private element: ElementRef,\n    private sanitization: DomSanitizer,\n    private service: UshioService\n  ) {\n    this.showLangMenu = this.showLangMenu.bind(this)\n    this.onComponentClicked = this.onComponentClicked.bind(this)\n    this.onDocumentClicked = this.onDocumentClicked.bind(this)\n  }\n\n  ngOnInit () {\n    this.mPaused = this.video.nativeElement.paused\n    this.mVolume = this.video.nativeElement.volume\n    this.mPlaybackRate = this.video.nativeElement.playbackRate\n  }\n\n  ngAfterContentInit () {\n    const mapPropsToObject = (props: string[], fn) => (sourceObj: any) => (\n      props.reduce((agg, cur) => ({ ...agg, [cur]: fn(sourceObj, cur) }), {})\n    )\n    const onContentChildrenOrSlotChanged$ = (\n      attr, contentChildren:\n      QueryList<any>,\n      slotChange$: Observable<HTMLElement[]>\n    ) => {\n      const contentChildrenMap = mapPropsToObject(attr, (obj, cur) => (obj[cur]))\n      const slotMap = mapPropsToObject(attr, (obj, cur) => (obj.getAttribute(cur)))\n      return merge(\n        of(contentChildren.toArray().map(contentChildrenMap)),\n        contentChildren.changes.pipe(\n          map((contents: QueryList<any>) => (contents.toArray().map(contentChildrenMap)))\n        ),\n        slotChange$.pipe(\n          map((contents: HTMLElement[]) => (\n            contents.map(slotMap)\n          ))\n        )\n      )\n    }\n    const subtitlesAttr = ['value', 'type', 'src', 'name', 'class', 'default', 'srclang']\n    const subtitlesChange$ = onContentChildrenOrSlotChanged$(\n      subtitlesAttr, this.subtitlesContentChildren, this.subtitlesSlotChange$)\n    this.subscriptions.push(subtitlesChange$.subscribe(async (subtitles) => {\n      this.mSubtitles = subtitles\n      await this.updateSubtitles()\n    }))\n    const sourcesAttr = ['src', 'type', 'name', 'shortname', 'default']\n    const sourcesChange$ = onContentChildrenOrSlotChanged$(\n      sourcesAttr, this.sourceContentChildren, this.sourcesSlotChange$)\n    this.subscriptions.push(sourcesChange$.subscribe((sources) => {\n      this.mSources = sources\n      this.updateSources()\n    }))\n  }\n\n  ngAfterViewInit () {\n    const mouseMove$ = fromEvent(document, 'mousemove')\n    const mouseUp$ = fromEvent(document, 'mouseup')\n    const touchMove$ = fromEvent(document, 'touchmove')\n    const touchStart$ = fromEvent(document, 'touchstart')\n    const touchEnd$ = merge(\n      fromEvent(document, 'touchend'),\n      fromEvent(document, 'touchcancel')\n    )\n    const mouseTouchUp$ = merge(mouseUp$, touchEnd$)\n    touchStart$.subscribe(() => {\n      this.interactMode = 'mobile'\n    })\n    const ifMouseInArea = (e: MouseEvent, btnElement, popUpElement) => {\n      const rect1 = popUpElement.getBoundingClientRect()\n      const rect2 = btnElement.getBoundingClientRect()\n      return (e.clientX > rect1.left &&\n        e.clientX < rect1.right &&\n        e.clientY > rect1.top &&\n        e.clientY < rect1.bottom) || (e.clientX > rect2.left &&\n        e.clientX < rect2.right &&\n        e.clientY > rect2.top &&\n        e.clientY < rect2.bottom)\n    }\n    const onControlBtnHoverStateChanged$ = (btns) => {\n      return mouseMove$.pipe(\n        switchMap((e: MouseEvent) => {\n          for (const btn of btns) {\n            if (ifMouseInArea(e, btn.btnElement, btn.popUpElement)) {\n              return of(` btn-${btn.btnName}-hover`)\n            }\n          }\n          return timer(150).pipe(\n            mapTo('')\n          )\n        }),\n        distinctUntilChanged()\n      )\n    }\n    const desktopShowControlStateChange$ = mouseMove$.pipe(\n      filter(() => (this.interactMode === 'desktop')),\n      map((e: MouseEvent) => {\n        const rect = this.video.nativeElement.getBoundingClientRect()\n        return {\n          showControl: e.clientX > rect.left &&\n            e.clientX < rect.right &&\n            e.clientY > rect.top &&\n            e.clientY < rect.bottom,\n          delaySwitch: e.clientY < rect.bottom - 46\n        }\n      })\n    )\n    const showControlStateChange$ = merge(\n      desktopShowControlStateChange$,\n      this.mobileShowControlStateChange$\n    ).pipe(\n      switchMap(e => {\n        return e.showControl\n          ? merge(\n            of(true),\n            e.delaySwitch ? timer(\n              this.interactMode === 'desktop' ? 750 : 5000\n            ).pipe(\n              mapTo(false)\n            ) : NEVER\n          )\n          : of(false)\n      }),\n      distinctUntilChanged()\n    )\n    this.subscriptions.push(showControlStateChange$.subscribe(state => {\n      this.mShowControl = state\n    }))\n    const mouseHoverProgressState$ = mouseMove$.pipe(\n      filter(() => (this.interactMode === 'desktop')),\n      map((e: MouseEvent) => {\n        const rect = this.slider.nativeElement.getBoundingClientRect()\n        const yCenter = (rect.top + rect.bottom) / 2\n        if (Math.abs(e.clientY - yCenter) < 8 && e.clientX > rect.left && e.clientX < rect.right) {\n          const left = e.clientX - rect.left\n          const containerLeft = left < 80 ? 90 - left : left > rect.width - 80 ? rect.width - left - 70 : 10\n          const timeLeft = left < 20 ? 30 - left : left > rect.width - 20 ? rect.width - left - 10 : 10\n          return { left, containerLeft, timeLeft, width: rect.width }\n        } else {\n          return false\n        }\n      })\n    )\n    this.subscriptions.push(mouseHoverProgressState$.subscribe(state => {\n      if (!state) {\n        this.showProgressDetail = false\n      } else {\n        this.showProgressDetail = true\n        this.mProgressDetailPosition = `left: ${state.left}px`\n        this.mProgressDetailContainerPosition = `left: ${state.containerLeft}px`\n        this.mProgressDetailTimePosition = `left: ${state.timeLeft}px`\n        this.mProgressDetailPositionRate = state.left / state.width\n      }\n    }))\n    if (this.mPaused) this.video.nativeElement.pause()\n    else this.video.nativeElement.play()\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'pause')\n      .subscribe(() => {\n        this.mPaused = true\n        this.pausedChange.emit(true)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'play')\n      .subscribe(() => {\n        this.mPaused = false\n        this.pausedChange.emit(false)\n      }))\n    const subscribeTimeUpdate = () => {\n      this.timeUpdate = fromEvent(this.video.nativeElement, 'timeupdate')\n        .subscribe(() => {\n          this.mCurrentTime = this.video.nativeElement.currentTime\n          this.currentTimeChange.emit(this.mCurrentTime)\n          this.updateFlyingSubtitles(this.mCurrentTime)\n        })\n    }\n    subscribeTimeUpdate()\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'waiting')\n      .subscribe(() => {\n        this.waiting = true\n        this.waitingChange.emit(this.waiting)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'playing')\n      .subscribe(() => {\n        this.waiting = false\n        this.waitingChange.emit(this.waiting)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'progress')\n      .subscribe(() => {\n        this.bufferedTime = ((timeRanges, currentTime) => {\n          const length = timeRanges.length\n          for (let i = 0; i < length; i++) {\n            if (timeRanges.end(i) <= currentTime) {\n              continue\n            }\n            if (timeRanges.start(i) <= currentTime) {\n              return timeRanges.end(i)\n            }\n            return currentTime\n          }\n          return currentTime\n        })(this.video.nativeElement.buffered, this.video.nativeElement.currentTime)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'loadedmetadata')\n      .subscribe(() => {\n        this.duration = this.video.nativeElement.duration\n        this.durationChange.emit(this.duration)\n      }))\n    this.video.nativeElement.volume = this.mVolume\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'volumechange')\n      .subscribe(() => {\n        this.mVolume = this.video.nativeElement.volume\n        this.volumeChange.emit(this.mVolume)\n      }))\n    this.video.nativeElement.playbackRate = this.mPlaybackRate\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'ratechange')\n      .subscribe(() => {\n        this.mPlaybackRate = this.video.nativeElement.playbackRate\n        this.playbackRateChange.emit(this.mPlaybackRate)\n      }))\n    const mapToRate = (element, progress, total) => map(\n      (moveEvent: MouseEvent | TouchEvent) => {\n        const eventCoordinate = moveEvent instanceof TouchEvent\n          ? moveEvent.changedTouches[0]\n          : moveEvent\n        const rect = element.getBoundingClientRect()\n        let p = progress(eventCoordinate, rect)\n        const t = total(rect)\n        if (p < 0) p = 0\n        else if (p > t) p = t\n        return p / t\n      }\n    )\n    const onMouseTouchDown$ = (element, progress, total) => {\n      return merge(\n        fromEvent(element, 'mousedown'),\n        fromEvent(element, 'touchstart')\n      ).pipe(\n        mapToRate(element, progress, total)\n      )\n    }\n    const onMouseTouchDrag$ = (element, progress, total) => {\n      return merge(\n        fromEvent(element, 'mousedown').pipe(\n          mapToRate(element, progress, total),\n          concatMap(() => {\n            return mouseMove$.pipe(\n              takeUntil(mouseUp$),\n              mapToRate(element, progress, total)\n            )\n          })\n        ),\n        fromEvent(element, 'touchstart').pipe(\n          mapToRate(element, progress, total),\n          concatMap(() => {\n            return touchMove$.pipe(\n              takeUntil(touchEnd$),\n              mapToRate(element, progress, total)\n            )\n          })\n        )\n      )\n    }\n    const thumbMouseTouchDown$ = onMouseTouchDown$(\n      this.slider.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    const thumbTouchDrag$ = onMouseTouchDrag$(\n      this.slider.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    this.subscriptions.push(thumbMouseTouchDown$.subscribe(e => {\n      this.thumbMouseDown = true\n      this.timeUpdate.unsubscribe()\n      this.mCurrentTime = e * this.duration\n    }))\n    this.subscriptions.push(thumbTouchDrag$.subscribe(e => {\n      this.mCurrentTime = e * this.duration\n    }))\n    this.subscriptions.push(mouseTouchUp$.subscribe(() => {\n      if (this.thumbMouseDown) {\n        this.video.nativeElement.currentTime = this.mCurrentTime\n        subscribeTimeUpdate()\n        this.thumbMouseDown = false\n      }\n    }))\n    const controlHoverStateChange$ = onControlBtnHoverStateChanged$([{\n      btnElement: this.volumeBtn.nativeElement,\n      popUpElement: this.volumePanel.nativeElement,\n      btnName: 'volume'\n    }, {\n      btnElement: this.settingsBtn.nativeElement,\n      popUpElement: this.settingsPanel.nativeElement,\n      btnName: 'settings'\n    }, {\n      btnElement: this.sourceBtn.nativeElement,\n      popUpElement: this.sourcePanel.nativeElement,\n      btnName: 'source'\n    }, {\n      btnElement: this.subtitlesBtn.nativeElement,\n      popUpElement: this.subtitlesPanel.nativeElement,\n      btnName: 'subtitles'\n    }])\n    const subscribeControlHoveredChange = () => {\n      this.controlHoveredChange = controlHoverStateChange$.subscribe(e => {\n        this.controlHoveredClass = e\n        this.setAllControlPanelsPosition()\n      })\n    }\n    subscribeControlHoveredChange()\n    const hoverStateChange$ = merge(showControlStateChange$, controlHoverStateChange$).pipe(\n      map(() => this.showControl),\n      distinctUntilChanged()\n    )\n    this.subscriptions.push(hoverStateChange$.subscribe(e => {\n      this.showControlChange.emit(e)\n    }))\n    const volumeMouseTouchDown$ = onMouseTouchDown$(\n      this.volumeBar.nativeElement,\n      (moveEvent, rect) => (rect.bottom - moveEvent.clientY),\n      (rect) => (rect.height)\n    )\n    const volumeTouchDrag$ = onMouseTouchDrag$(\n      this.volumeBar.nativeElement,\n      (moveEvent, rect) => (rect.bottom - moveEvent.clientY),\n      (rect) => (rect.height)\n    )\n    this.subscriptions.push(volumeMouseTouchDown$.subscribe(e => {\n      if (!this.controlMouseDown) {\n        this.controlMouseDown = true\n        this.controlHoveredChange.unsubscribe()\n      }\n      this.video.nativeElement.muted = false\n      this.video.nativeElement.volume = e\n    }))\n    this.subscriptions.push(volumeTouchDrag$.subscribe(e => {\n      this.video.nativeElement.volume = e\n    }))\n    this.subscriptions.push(mouseTouchUp$.subscribe(() => {\n      if (this.controlMouseDown) {\n        subscribeControlHoveredChange()\n        this.controlMouseDown = false\n      }\n    }))\n    const speedMouseTouchDown$ = onMouseTouchDown$(\n      this.speedBar.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    const speedTouchDrag$ = onMouseTouchDrag$(\n      this.speedBar.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    this.subscriptions.push(speedMouseTouchDown$.subscribe(e => {\n      if (!this.controlMouseDown) {\n        this.controlMouseDown = true\n        this.controlHoveredChange.unsubscribe()\n      }\n      this.video.nativeElement.playbackRate = UshioComponent.mapProgressToSpeed(e)\n    }))\n    this.subscriptions.push(speedTouchDrag$.subscribe(e => {\n      this.video.nativeElement.playbackRate = UshioComponent.mapProgressToSpeed(e)\n    }))\n    const onKeyDown$ = code => fromEvent(document, 'keydown').pipe(\n      filter((e: KeyboardEvent) => this.focus && e.code === code),\n      tap(e => {\n        e.preventDefault()\n        e.stopPropagation()\n      })\n    )\n    this.subscriptions.push(onKeyDown$('Space').subscribe(e => {\n      this.togglePlay()\n    }))\n    this.subscriptions.push(onKeyDown$('ArrowRight').subscribe(() => {\n      this.mCurrentTime = this.mCurrentTime + 5 < this.duration ? this.mCurrentTime + 5 : this.duration\n      this.video.nativeElement.currentTime = this.mCurrentTime\n    }))\n    this.subscriptions.push(onKeyDown$('ArrowLeft').subscribe(() => {\n      this.mCurrentTime = this.mCurrentTime - 5 > 0 ? this.mCurrentTime - 5 : 0\n      this.video.nativeElement.currentTime = this.mCurrentTime\n    }))\n    this.subscriptions.push(onKeyDown$('ArrowUp').subscribe(() => {\n      this.mVolume = this.mVolume + 0.1 < 0.999996 ? this.mVolume + 0.1 : 1\n      this.video.nativeElement.volume = this.mVolume\n    }))\n    this.subscriptions.push(onKeyDown$('ArrowDown').subscribe(() => {\n      this.mVolume = this.mVolume - 0.1 > 0.000004 ? this.mVolume - 0.1 : 0\n      this.video.nativeElement.volume = this.mVolume\n    }))\n    const showVolumeHint$ = merge(onKeyDown$('ArrowUp'), onKeyDown$('ArrowDown'))\n    const dismissVolumeHint$ = showVolumeHint$.pipe(switchMap(() => timer(1000)))\n    this.subscriptions.push(showVolumeHint$.subscribe(() => {\n      this.showVolumeHint = true\n    }))\n    this.subscriptions.push(dismissVolumeHint$.subscribe(() => {\n      this.showVolumeHint = false\n    }))\n    this.setAllControlPanelsPosition()\n    this.subscriptions.push(fromEvent(this.element.nativeElement, 'contextmenu')\n      .subscribe((e: MouseEvent) => {\n        e.preventDefault()\n        const outer = this.element.nativeElement.getBoundingClientRect()\n        const panel = this.contextMenu.nativeElement.getBoundingClientRect()\n        if (e.clientX + panel.width + 20 > outer.right) {\n          if (e.clientY + panel.height + 20 > outer.bottom) {\n            this.mContextMenuPosition = `right: ${outer.right - e.clientX}px; bottom: ${outer.bottom - e.clientY}px`\n          } else {\n            this.mContextMenuPosition = `right: ${outer.right - e.clientX}px; top: ${e.clientY - outer.top}px`\n          }\n        } else {\n          if (e.clientY + panel.height + 20 > outer.bottom) {\n            this.mContextMenuPosition = `left: ${e.clientX - outer.left}px; bottom: ${outer.bottom - e.clientY}px`\n          } else {\n            this.mContextMenuPosition = `left: ${e.clientX - outer.left}px; top: ${e.clientY - outer.top}px`\n          }\n        }\n        this.contextMenuState = 'root'\n        this.showContextMenu = true\n      }))\n    this.langContextMenuOption.nativeElement.addEventListener('click', this.showLangMenu, true)\n    this.element.nativeElement.addEventListener('click', this.onComponentClicked, true)\n    document.addEventListener('click', this.onDocumentClicked, true)\n    const animationFrame$ = of(null, animationFrameScheduler).pipe(repeat())\n    this.subscriptions.push(animationFrame$.subscribe(() => {\n      if (!this.fpsStart) this.fpsStart = +new Date()\n      this.fpsIndex++\n      const fpsCurrent = +new Date()\n      if (fpsCurrent - this.fpsStart > 1000) {\n        this.fps = ((this.fpsIndex / (fpsCurrent - this.fpsStart)) * 1000).toFixed(2)\n        this.fpsStart = +new Date()\n        this.fpsIndex = 0\n      }\n    }))\n  }\n\n  ngOnDestroy () {\n    if (this.timeUpdate) this.timeUpdate.unsubscribe()\n    if (this.controlHoveredChange) this.controlHoveredChange.unsubscribe()\n    this.subscriptions.forEach(sub => sub.unsubscribe())\n    this.langContextMenuOption.nativeElement.removeEventListener('click', this.showLangMenu, true)\n    this.element.nativeElement.removeEventListener('click', this.onComponentClicked, true)\n    document.removeEventListener('click', this.onDocumentClicked, true)\n  }\n\n  private updateSources () {\n    if (this.mSources.length === 0) {\n      this.sources = [{\n        shortName: 'Default',\n        name: 'Default',\n        default: true,\n        sources: [{ src: this.mSrc, type: undefined }]\n      }]\n    } else {\n      const sm = {}\n      this.mSources.forEach(source => {\n        if (!source.shortname) {\n          source.shortname = 'Untitled'\n        }\n        if (!sm[source.shortname]) {\n          sm[source.shortname] = {\n            shortName: source.shortname,\n            name: source.name || 'Untitled',\n            sources: []\n          }\n        }\n        sm[source.shortname].sources.push(source)\n        if (source.default !== undefined && source.default !== null) {\n          sm[source.shortname].default = true\n        }\n      })\n      this.sources = Object.values(sm)\n    }\n    const indexOfDefault = this.sources.findIndex(s => s.default)\n    this.playingSource = indexOfDefault >= 0 ? indexOfDefault : 0\n  }\n\n  private async updateSubtitles () {\n    const parsedSubtitles = []\n    for (const sub of this.mSubtitles) {\n      let text = ''\n      if (sub.value) text = sub.value\n      else if (sub.src) {\n        const resp = await fetch(sub.src)\n        text = await resp.text()\n      }\n      const parsed = {\n        name: sub.name || 'Untitled',\n        class: sub.class || '',\n        parsedSubtitles: undefined,\n        enabled: sub.default !== undefined && sub.default !== null\n          || sub.srclang === this.service.i18n.language\n      }\n      sub.type = sub.type || ''\n      sub.type = sub.type.toLowerCase()\n      if (sub.type !== 'text/vtt' && sub.type !== 'application/x-subrip') {\n        console.warn('Unknown MIME type of subtitles, trying to infer subtitle format. Supported type: text/vtt, application/x-subrip.')\n      }\n      try {\n        parsed.parsedSubtitles = this.service.parseSubtitles(text)\n      } catch (e) {\n        console.error(e)\n      }\n      parsedSubtitles.push(parsed)\n    }\n    this.subtitles = parsedSubtitles\n    this.updateFlyingSubtitles()\n  }\n\n  private updateFlyingSubtitles (currentTime?) {\n    if (currentTime === undefined) {\n      currentTime = this.video.nativeElement.currentTime\n    }\n    currentTime *= 1000\n    const flyingSubtitles = []\n    this.enabledSubtitles.forEach(subtitles => {\n      if (!subtitles.parsedSubtitles) return\n      const flyingSubtitlesTrack = []\n      subtitles.parsedSubtitles.forEach(subtitle => {\n        if (currentTime > subtitle.startTime && currentTime < subtitle.endTime) {\n          flyingSubtitlesTrack.push({\n            ...subtitle,\n            texts: subtitle.texts.map(text => this.sanitization.bypassSecurityTrustHtml(text))\n          })\n        }\n      })\n      if (flyingSubtitlesTrack.length) {\n        flyingSubtitles.push({\n          name: subtitles.name,\n          class: subtitles.class,\n          parsedSubtitles: flyingSubtitlesTrack\n        })\n      }\n    })\n    this.flyingSubtitles = flyingSubtitles\n  }\n\n  private setAllControlPanelsPosition () {\n    setTimeout(() => {\n      [{\n        btn: this.settingsBtn,\n        panel: this.settingsPanel,\n        name: 'settings'\n      }, {\n        btn: this.sourceBtn,\n        panel: this.sourcePanel,\n        name: 'source'\n      }, {\n        btn: this.subtitlesBtn,\n        panel: this.subtitlesPanel,\n        name: 'subtitles'\n      }, {\n        btn: this.loopBtn,\n        panel: this.loopPanel,\n        name: 'loop'\n      }, {\n        btn: this.fullScreenBtn,\n        panel: this.fullScreenPanel,\n        name: 'fullscreen'\n      }].forEach(item => this.setPanelPosition(item.btn, item.panel, item.name))\n    }, 0)\n  }\n\n  private setPanelPosition (btn, panel, name) {\n    if (!this.element || !panel || !btn) return\n    const outerRect = this.element.nativeElement.getBoundingClientRect()\n    const panelRect = panel.nativeElement.getBoundingClientRect()\n    const btnRect = btn.nativeElement.getBoundingClientRect()\n    if (panelRect.width / 2 - outerRect.right + btnRect.right > 0) {\n      this.panelTranslations[name] = panelRect.width / 2 - outerRect.right + btnRect.right\n    } else {\n      this.panelTranslations[name] = 0\n    }\n  }\n\n  onSlotChange (e) {\n    this.subtitlesSlotUpdate$.next(\n      e.target.assignedNodes().filter(node => node.nodeName === 'USHIO-SUBTITLES')\n    )\n    this.sourcesSlotUpdate$.next(\n      e.target.assignedNodes().filter(node => node.nodeName === 'USHIO-SOURCE')\n    )\n    this.mInjectedStyles = e.target.assignedNodes()\n      .filter(node => node.nodeName === 'STYLE').map(node => node.innerHTML)\n  }\n\n  onVideoMaskClicked () {\n    if (this.interactMode === 'desktop') {\n      this.togglePlay()\n    } else {\n      this.mobileShowControlStateChange$.next({\n        showControl: !this.mShowControl,\n        delaySwitch: true\n      })\n    }\n  }\n\n  onSelectSource (i) {\n    if (i === this.playingSource) return\n    const currentTime = this.mCurrentTime\n    const paused = this.mPaused\n    this.playingSource = i\n    this.video.nativeElement.load()\n    this.video.nativeElement.currentTime = currentTime\n    if (!paused) this.video.nativeElement.play()\n  }\n\n  onCheckSubtitles (i) {\n    this.subtitles[i].enabled = !this.subtitles[i].enabled\n    this.updateFlyingSubtitles()\n  }\n\n  togglePlay () {\n    if (this.video.nativeElement.paused) this.video.nativeElement.play()\n    else this.video.nativeElement.pause()\n  }\n\n  toggleMute () {\n    if (this.interactMode === 'desktop') {\n      this.video.nativeElement.muted = !(this.video.nativeElement.muted || this.video.nativeElement.volume === 0)\n      this.mutedChange.emit(this.video.nativeElement.muted)\n    } else if (this.video.nativeElement.muted) {\n      this.video.nativeElement.muted = false\n      this.mutedChange.emit(false)\n    }\n    if (!this.video.nativeElement.muted && this.video.nativeElement.volume === 0) {\n      this.video.nativeElement.volume = Math.random()\n    }\n  }\n\n  toggleLoop () {\n    this.video.nativeElement.loop = !this.video.nativeElement.loop\n    this.loopChange.emit(this.video.nativeElement.loop)\n  }\n\n  toggleFullscreen () {\n    if (!this.isFullScreen) {\n      this.element.nativeElement.requestFullscreen()\n    } else {\n      document.exitFullscreen()\n    }\n  }\n\n  showLangMenu () {\n    this.contextMenuState = 'lang'\n    this.showContextMenu = true\n  }\n\n  onComponentClicked () {\n    this.focus = true\n    this.showContextMenu = false\n  }\n\n  onDocumentClicked () {\n    this.focus = false\n    this.showContextMenu = false\n  }\n\n  setLanguage (code) {\n    this.service.i18n.setLanguage(code)\n  }\n\n  toggleShowStatisticInfoPanel () {\n    this.showStatisticInfoPanel = !this.showStatisticInfoPanel\n  }\n\n}\n","import { CommonModule } from '@angular/common'\nimport { NgModule } from '@angular/core'\n\nimport { UshioComponent, UshioSource, UshioSubtitles } from './ushio.component'\n\n@NgModule({\n  declarations: [\n    UshioComponent,\n    UshioSource,\n    UshioSubtitles\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    UshioComponent,\n    UshioSource,\n    UshioSubtitles\n  ]\n})\nexport class UshioModule { }\n"]}