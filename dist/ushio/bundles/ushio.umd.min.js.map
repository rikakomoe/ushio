{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://ushio/lib/ushio.service.ts","ng://ushio/lib/ushio.component.ts","ng://ushio/lib/ushio.module.ts"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__values","o","m","UshioI18nProvider","lang","i18nSource","en","speed","normal","loop","noLoop","fullscreen","exitFullscreen","statistic","language","mute","zh-Hans","_b","tslib_1.__values","navigator","languages","_c","langCode","setLanguage","bind","defineProperty","entries","map","entry","key","UshioService","timeStampRegex","i18n","version","build","parseSubtitles","input","str","_this","origin","trim","replace","split","splitSubtitles","cachedSubtitle","state","forEach","line","match","exec","startTime","endTime","texts","Error","processLine","Injectable","args","providedIn","UshioSource","Directive","selector","Input","UshioSubtitles","UshioComponent","element","zone","changeDetectorRef","sanitization","service","mInjectedStyles","preload","mSources","sources","playingSource","mSubtitles","subtitles","flyingSubtitles","mVolume","volumeChange","EventEmitter","mPlaybackRate","playbackRateChange","mVolumeControl","mSourceControl","mSubtitlesControl","mSettingsControl","mLoopControl","mFullscreenControl","subtitlesSlotUpdate$","Subject","sourcesSlotUpdate$","subtitlesSlotChange$","asObservable","pipe","distinctUntilChanged","sourcesSlotChange$","mobileShowControlStateChange$","interactMode","focus","mShowControl","mNoCursor","thumbMouseDown","controlMouseDown","controlHoveredClass","showContextMenu","showStatisticInfoPanel","showVolumeHint","showProgressDetail","showControlChange","mPaused","pausedChange","mCurrentTime","currentTimeChange","duration","durationChange","bufferedTime","waiting","waitingChange","loopChange","mutedChange","fps","fpsStart","fpsIndex","panelTranslations","settings","source","mContextMenuPosition","mProgressDetailPosition","mProgressDetailContainerPosition","mProgressDetailTimePosition","mProgressDetailPositionRate","contextMenuState","subscriptions","showLangMenu","onComponentClicked","onDocumentClicked","style","bypassSecurityTrustHtml","mSrc","src","updateSources","filter","enabled","volume","video","nativeElement","muted","Math","round","playbackRate","volumeControl","setAllControlPanelsPosition","sourceControl","subtitlesControl","settingsControl","loopControl","fullscreenControl","document","fullscreenElement","mouseDown","showControl","enabledSubtitles","isFullScreen","paused","pause","play","currentTime","formatDuration","bypassSecurityTrustStyle","volume100","mapSpeedToProgress","height","videoHeight","videoWidth","thumbnails","ceil","toFixed","mapProgressToSpeed","progress","floor","h","ngOnInit","ngAfterContentInit","mapPropsToObject","props","fn","sourceObj","reduce","agg","cur","_a","onContentChildrenOrSlotChanged$","attr","contentChildren","slotChange$","contentChildrenMap","obj","slotMap","getAttribute","merge","of","toArray","changes","contents","subtitlesChange$","subtitlesContentChildren","sourcesChange$","sourceContentChildren","runOutsideAngular","subscribe","updateSubtitles","detectChanges","ngAfterViewInit","mouseMove$","fromEvent","mouseUp$","touchMove$","touchStart$","touchEnd$","mouseTouchUp$","ifMouseInArea","btnElement","popUpElement","rect1","getBoundingClientRect","rect2","clientX","left","right","clientY","top","bottom","desktopShowControlStateChange$","rect","delaySwitch","showControlStateChange$","switchMap","noCursor","timer","mapTo","NEVER","a","b","mouseHoverProgressState$","slider","yCenter","abs","containerLeft","width","timeLeft","emit","subscribeTimeUpdate","timeUpdate","updateFlyingSubtitles","timeRanges","end","start","buffered","mapToRate","total","moveEvent","eventCoordinate","TouchEvent","changedTouches","onMouseTouchDown$","onMouseTouchDrag$","concatMap","takeUntil","thumbMouseTouchDown$","thumbTouchDrag$","unsubscribe","btns","controlHoverStateChange$","volumeBtn","volumePanel","btnName","settingsBtn","settingsPanel","sourceBtn","sourcePanel","subtitlesBtn","subtitlesPanel","btns_1","btns_1_1","btn","subscribeControlHoveredChange","controlHoveredChange","hoverStateChange$","volumeMouseTouchDown$","volumeBar","volumeTouchDrag$","speedMouseTouchDown$","speedBar","speedTouchDrag$","onKeyDown$","code","tap","preventDefault","stopPropagation","togglePlay","showVolumeHint$","outer","panel","contextMenu","langContextMenuOption","addEventListener","animationFrame$","animationFrameScheduler","repeat","Date","fpsCurrent","ngOnDestroy","sub","removeEventListener","shortName","name","default","type","undefined","sm_1","shortname","values","indexOfDefault","findIndex","parsedSubtitles","text","fetch","_d","parsed","class","srclang","toLowerCase","console","warn","error","flyingSubtitlesTrack","subtitle","setTimeout","loopBtn","loopPanel","fullScreenBtn","fullScreenPanel","item","setPanelPosition","outerRect","panelRect","btnRect","onSlotChange","target","assignedNodes","node","nodeName","innerHTML","onVideoMaskClicked","onSelectSource","load","onCheckSubtitles","toggleMute","random","toggleLoop","toggleFullscreen","requestFullscreen","toggleShowStatisticInfoPanel","Component","template","encapsulation","ViewEncapsulation","ShadowDom","ElementRef","NgZone","ChangeDetectorRef","DomSanitizer","Output","ViewChild","static","ContentChildren","UshioModule","NgModule","declarations","imports","CommonModule","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable } from '@angular/core'\n\nexport interface ISubtitle {\n  startTime: number\n  endTime: number\n  texts: string[]\n}\n\nclass UshioI18nProvider {\n  private lang = 'en'\n  private readonly i18nSource = {\n    en: {\n      lang: 'English',\n      speed: 'Speed',\n      normal: 'Normal',\n      loop: 'Loop',\n      noLoop: 'No Loop',\n      fullscreen: 'Fullscreen',\n      exitFullscreen: 'Exit fullscreen',\n      statistic: 'Video statistic',\n      language: 'Language',\n      mute: 'Mute'\n    },\n    'zh-Hans': {\n      lang: 'ç®ä½ä¸­æ',\n      speed: 'æ­æ¾éåº¦',\n      normal: 'æ­£å¸¸',\n      loop: 'å¾ªç¯æ­æ¾',\n      noLoop: 'å³é­å¾ªç¯',\n      fullscreen: 'å¨å±æ­æ¾',\n      exitFullscreen: 'éåºå¨å±',\n      statistic: 'è§é¢ç»è®¡ä¿¡æ¯',\n      language: 'è¯­è¨',\n      mute: 'éé³'\n    }\n  }\n  get languages () {\n    return Object.entries(this.i18nSource).map(entry => [entry[0], entry[1].lang])\n  }\n  get language () {\n    return this.lang\n  }\n\n  constructor () {\n    for (const langCode of navigator.languages) {\n      if (this.setLanguage(langCode)) break\n    }\n    this.t = this.t.bind(this)\n  }\n\n  setLanguage (langCode): boolean {\n    if (this.i18nSource[langCode]) {\n      this.lang = langCode\n      return true\n    }\n    return false\n  }\n\n  t (key: string): string {\n    return this.i18nSource[this.lang][key]\n  }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class UshioService {\n\n  static version = '4.0.0'\n  static build = 'NG Build'\n\n  // tslint:disable-next-line:max-line-length\n  private readonly timeStampRegex = /^(?:(\\d{2,})(:))?([0-5][0-9])(:)([0-5][0-9])([,.])(\\d{3})( --> )(?:(\\d{2,})(:))?([0-5][0-9])(:)([0-5][0-9])([,.])(\\d{3})/\n  i18n = new UshioI18nProvider()\n  get version () {\n    return UshioService.version\n  }\n  get build () {\n    return UshioService.build\n  }\n\n  constructor () { }\n\n  parseSubtitles (input: string): ISubtitle[] {\n    const trim = (str: string) => str.trim()\n      .replace(/^[^\\S\\n]+/gm, '')\n      .replace(/\\u0000/g, '\\uFFFD')\n      .replace(/\\r\\n/g, '\\n')\n      .replace(/\\r/g, '\\n')\n      .replace(/\\n{3,}/g, '\\n\\n')\n    const origin = trim(input)\n      .split('\\n')\n    const splitSubtitles: ISubtitle[] = []\n    let cachedSubtitle: ISubtitle | null = null\n    let state = 'root'\n    const processLine = (line: string) => {\n      switch (state) {\n        case 'note':\n        /* falls through */\n        case 'title':\n          if (line === '') {\n            state = 'root'\n          }\n          return\n        case 'root':\n          if (line.match(/^WEBVTT/)) {\n            state = 'title'\n            return\n          } else if (line.match(/^NOTE/)) {\n            state = 'note'\n            return\n          } else if (line === '') return [line]\n          else if (!line.match(/-->/)) {\n            state = 'timeline'\n            return\n          }\n        /* falls through */\n        case 'timeline':\n          const match = this.timeStampRegex.exec(line)\n          if (match) {\n            cachedSubtitle = {\n              startTime: 1000 * (60 * (60 * +match[1] + +match[3]) + +match[5]) + +match[7] || 0,\n              endTime: 1000 * (60 * (60 * +match[9] + +match[11]) + +match[13]) + +match[15] || 0,\n              texts: []\n            }\n            state = 'text'\n            return\n          } else {\n            throw new Error(`unexpected timeline token: ${line}`)\n          }\n        case 'text':\n          if (line === '') {\n            state = 'root'\n            if (cachedSubtitle) {\n              splitSubtitles.push(cachedSubtitle)\n              cachedSubtitle = null\n            }\n          } else if (cachedSubtitle) {\n            cachedSubtitle.texts.push(line)\n          }\n      }\n    }\n    origin.forEach(line => processLine(line))\n    if (cachedSubtitle) splitSubtitles.push(cachedSubtitle)\n    return splitSubtitles\n  }\n\n}\n","import {\n  AfterContentInit,\n  AfterViewInit, ChangeDetectorRef,\n  Component,\n  ContentChildren,\n  Directive,\n  ElementRef, EventEmitter,\n  Input, NgZone,\n  OnDestroy,\n  OnInit, Output,\n  QueryList,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core'\nimport { DomSanitizer, SafeStyle } from '@angular/platform-browser'\nimport {\n  animationFrameScheduler,\n  fromEvent, merge, NEVER, Observable, of,\n  Subject, Subscription, timer\n} from 'rxjs'\nimport {\n  concatMap, distinctUntilChanged,\n  filter, map, mapTo, repeat, switchMap, takeUntil, tap\n} from 'rxjs/operators'\n\nimport { ISubtitle, UshioService } from './ushio.service'\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: 'ushio-source'\n})\nexport class UshioSource {\n  @Input() src!: string\n  @Input() type: string\n  @Input() shortname: string\n  @Input() name: string\n  @Input() default: boolean\n}\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: 'ushio-subtitles'\n})\nexport class UshioSubtitles {\n  @Input() value: string\n  @Input() src: string\n  @Input() type: string\n  @Input() name: string\n  @Input() class: string\n  @Input() srclang: string\n  @Input() default: boolean\n}\n\ninterface Source {\n  shortName: string\n  name: string\n  sources: {\n    src: string;\n    type: string;\n  }[]\n  default?: boolean\n}\n\ninterface Subtitles {\n  name: string\n  class: string\n  parsedSubtitles: ISubtitle[]\n  enabled: boolean\n}\n\n@Component({\n  selector: 'ushio-player',\n  templateUrl: './ushio.component.html',\n  styleUrls: ['./ushio.component.styl'],\n  encapsulation: ViewEncapsulation.ShadowDom\n})\nexport class UshioComponent implements OnInit, AfterContentInit, AfterViewInit, OnDestroy {\n\n  private mInjectedStyles = []\n  get injectedStyles () {\n    return this.mInjectedStyles.map(\n      style => this.sanitization.bypassSecurityTrustHtml(`\n      <style>\n       ${style}\n      </style>\n    `))\n  }\n\n  @Input() set src (src) {\n    this.mSrc = src\n    this.updateSources()\n  }\n  get src () {\n    return this.mSrc\n  }\n  @Input() poster\n  @Input() crossorigin\n  @Input() autoplay\n  @Input() preload = 'metadata'\n  @Input() set lang (lang: string) {\n    this.service.i18n.setLanguage(lang)\n  }\n  @Input() thumbnails\n\n  private mSrc\n  private mSources = []\n  sources: Source[] = []\n  playingSource = 0\n\n  private mSubtitles = []\n  subtitles: Subtitles[] = []\n  get enabledSubtitles () {\n    return this.subtitles.filter(s => s.enabled)\n  }\n  flyingSubtitles: Subtitles[] = []\n\n  private mVolume = 1\n  @Input() set volume (volume) {\n    this.video.nativeElement.volume = volume\n  }\n  get volume100 () {\n    if (this.video.nativeElement.muted) return 0\n    return Math.round(this.mVolume * 100)\n  }\n  @Output() volumeChange = new EventEmitter<number>()\n\n  private mPlaybackRate = 1\n  @Input() set playbackRate (playbackRate) {\n    this.video.nativeElement.playbackRate = playbackRate\n  }\n  @Output() playbackRateChange = new EventEmitter<number>()\n\n  private mVolumeControl = true\n  @Input() set volumeControl (volumeControl) {\n    this.mVolumeControl = volumeControl\n    this.setAllControlPanelsPosition()\n  }\n  get volumeControl () {\n    return this.mVolumeControl\n  }\n  private mSourceControl = true\n  @Input() set sourceControl (sourceControl) {\n    this.mSourceControl = sourceControl\n    this.setAllControlPanelsPosition()\n  }\n  get sourceControl () {\n    return this.mSourceControl\n  }\n  private mSubtitlesControl = true\n  @Input() set subtitlesControl (subtitlesControl) {\n    this.mSubtitlesControl = subtitlesControl\n    this.setAllControlPanelsPosition()\n  }\n  get subtitlesControl () {\n    return this.mSubtitlesControl\n  }\n  private mSettingsControl = true\n  @Input() set settingsControl (settingsControl) {\n    this.mSettingsControl = settingsControl\n    this.setAllControlPanelsPosition()\n  }\n  get settingsControl () {\n    return this.mSettingsControl\n  }\n  private mLoopControl = true\n  @Input() set loopControl (loopControl) {\n    this.mLoopControl = loopControl\n    this.setAllControlPanelsPosition()\n  }\n  get loopControl () {\n    return this.mLoopControl\n  }\n  private mFullscreenControl = true\n  @Input() set fullscreenControl (fullscreenControl) {\n    this.mFullscreenControl = fullscreenControl\n    this.setAllControlPanelsPosition()\n  }\n  get fullscreenControl () {\n    return this.mFullscreenControl\n  }\n\n  @ViewChild('video', { static: true }) video\n  @ViewChild('slider', { static: true }) slider\n  @ViewChild('volumeBar', { static: true }) volumeBar\n  @ViewChild('volumePanel', { static: true }) volumePanel\n  @ViewChild('volumeBtn', { static: true }) volumeBtn\n  @ViewChild('settingsPanel', { static: true }) settingsPanel\n  @ViewChild('settingsBtn', { static: true }) settingsBtn\n  @ViewChild('speedBar', { static: true }) speedBar\n  @ViewChild('sourcePanel', { static: true }) sourcePanel\n  @ViewChild('sourceBtn', { static: true }) sourceBtn\n  @ViewChild('subtitlesPanel', { static: true }) subtitlesPanel\n  @ViewChild('subtitlesBtn', { static: true }) subtitlesBtn\n  @ViewChild('loopBtn', { static: true }) loopBtn\n  @ViewChild('loopPanel', { static: true }) loopPanel\n  @ViewChild('fullScreenBtn', { static: true }) fullScreenBtn\n  @ViewChild('fullScreenPanel', { static: true }) fullScreenPanel\n  @ViewChild('contextMenu', { static: true }) contextMenu\n  @ViewChild('langContextMenuOption', { static: true }) langContextMenuOption\n\n  @ContentChildren(UshioSource) sourceContentChildren!: QueryList<UshioSource>\n  @ContentChildren(UshioSubtitles) subtitlesContentChildren!: QueryList<UshioSubtitles>\n  private subtitlesSlotUpdate$ = new Subject<HTMLElement[]>()\n  private sourcesSlotUpdate$ = new Subject<HTMLElement[]>()\n  private subtitlesSlotChange$ = this.subtitlesSlotUpdate$.asObservable().pipe(distinctUntilChanged())\n  private sourcesSlotChange$ = this.sourcesSlotUpdate$.asObservable().pipe(distinctUntilChanged())\n  private mobileShowControlStateChange$ = new Subject<{ showControl: boolean, delaySwitch: boolean }>()\n\n  interactMode: 'desktop' | 'mobile' = 'desktop'\n  private focus = false\n  private mShowControl = false\n  private mNoCursor = false\n  private thumbMouseDown = false\n  private controlMouseDown = false\n  controlHoveredClass = ''\n  private showContextMenu = false\n  private showStatisticInfoPanel = false\n  private showVolumeHint = false\n  private showProgressDetail = false\n  get isFullScreen (): boolean {\n    return document.fullscreenElement !== null\n  }\n  get mouseDown (): boolean {\n    return this.thumbMouseDown || this.controlMouseDown\n  }\n  get showControl () {\n    return !!(this.mShowControl || this.controlHoveredClass || this.mouseDown)\n  }\n  get noCursor () {\n    return !this.showControl && this.mNoCursor\n  }\n  @Output() showControlChange = new EventEmitter<boolean>()\n  get thumbMouseDownClass (): string {\n    return this.thumbMouseDown ? ' thumb-mouse-down' : ''\n  }\n  get pausedClass (): string {\n    return this.mPaused ? ' video-state-pause' : ' video-state-play'\n  }\n  get waitingClass (): string {\n    return this.waiting && !this.mPaused ? ' video-state-waiting' : ''\n  }\n  get mutedClass (): string {\n    return (this.video.nativeElement.muted || this.video.nativeElement.volume === 0)\n      ? ' video-state-muted' : ' video-state-volume'\n  }\n  get loopClass (): string {\n    return this.video.nativeElement.loop ? ' video-state-loop' : ' video-state-noloop'\n  }\n  get subtitleEnabledClass (): string {\n    return this.enabledSubtitles.length > 0 ? ' video-state-subtitles' : ' video-state-nosubtitles'\n  }\n  get fullscreenClass (): string {\n    return this.isFullScreen ? ' video-state-fullscreen' : ' video-state-nofullscreen'\n  }\n  get contextMenuClass (): string {\n    return this.contextMenuState + (this.showContextMenu ? ' active' : '')\n  }\n  get statisticInfoPanelClass (): string {\n    return this.showStatisticInfoPanel ? ' active' : ''\n  }\n  get volumeHintClass (): string {\n    return this.showVolumeHint ? ' active' : ''\n  }\n  get progressDetailClass (): string {\n    return this.showProgressDetail ? ' active' : ''\n  }\n\n  private mPaused = true\n  @Input() set paused (paused) {\n    if (paused) this.video.nativeElement.pause()\n    else this.video.nativeElement.play()\n  }\n  @Output() pausedChange = new EventEmitter<boolean>()\n  private mCurrentTime = 0\n  @Input() set currentTime (currentTime) {\n    this.video.nativeElement.currentTime = currentTime\n  }\n  @Output() currentTimeChange = new EventEmitter<number>()\n  private duration = 0\n  @Output() durationChange = new EventEmitter<number>()\n  private bufferedTime = 0\n  private waiting = false\n  @Output() waitingChange = new EventEmitter<boolean>()\n  @Input() set loop (loop) {\n    this.video.nativeElement.loop = loop\n  }\n  @Output() loopChange = new EventEmitter<boolean>()\n  @Input() set muted (muted) {\n    this.video.nativeElement.muted = muted\n  }\n  @Output() mutedChange = new EventEmitter<boolean>()\n\n  fps = '0.00'\n  private fpsStart = 0\n  private fpsIndex = 0\n\n  get currentTimeStr (): string {\n    return UshioComponent.formatDuration(this.mCurrentTime)\n  }\n  get durationStr (): string {\n    return UshioComponent.formatDuration(this.duration)\n  }\n  get bufferedProgress (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: scaleX(${this.bufferedTime / this.duration})`\n    )\n  }\n  get playedProgress (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: scaleX(${this.mCurrentTime / this.duration})`\n    )\n  }\n  get thumbPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `left: ${this.mCurrentTime / this.duration * 100}%`\n    )\n  }\n  get volumeRate (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: scaleY(${this.volume100 / 100})`\n    )\n  }\n  get volumeThumbPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `bottom: ${this.volume100}%`\n    )\n  }\n  get speedThumbPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `left: ${UshioComponent.mapSpeedToProgress(this.mPlaybackRate)}%`\n    )\n  }\n  private panelTranslations = {\n    settings: 0,\n    source: 0,\n    subtitles: 0,\n    loop: 0,\n    fullscreen: 0\n  }\n  get settingsPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.settings}px - 50%))`\n    )\n  }\n  get sourcePanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.source}px - 50%))`\n    )\n  }\n  get subtitlesPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.subtitles}px - 50%))`\n    )\n  }\n  get loopPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.loop}px - 50%))`\n    )\n  }\n  get fullScreenPanelPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(\n      `transform: translateX(calc(${-this.panelTranslations.fullscreen}px - 50%))`\n    )\n  }\n  private mContextMenuPosition = ''\n  get contextMenuPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mContextMenuPosition)\n  }\n  private mProgressDetailPosition = ''\n  private mProgressDetailContainerPosition = ''\n  private mProgressDetailTimePosition = ''\n  private mProgressDetailPositionRate = 0\n  get progressDetailPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mProgressDetailPosition)\n  }\n  get progressDetailContainerPosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mProgressDetailContainerPosition)\n  }\n  get progressDetailTimePosition (): SafeStyle {\n    return this.sanitization.bypassSecurityTrustStyle(this.mProgressDetailTimePosition)\n  }\n  get progressDetailImgStyle (): SafeStyle {\n    const height = this.video.nativeElement.videoHeight * 160 / this.video.nativeElement.videoWidth\n    return this.sanitization.bypassSecurityTrustStyle(\n      `height: ${height}px;\n       line-height: ${height}px;\n       background-image: url(\"${this.thumbnails}\");\n       background-position: -${(Math.ceil(this.mProgressDetailPositionRate * 100) - 1) * 160}px 0;`\n    )\n  }\n  get progressDetailTime (): string {\n    return UshioComponent.formatDuration(this.mProgressDetailPositionRate * this.duration)\n  }\n\n  languages = this.service.i18n.languages\n  contextMenuState = 'root'\n  get version () {\n    return this.service.version\n  }\n  get detailedVersion () {\n    return `v${this.service.version} (${this.service.build})`\n  }\n  get videoResolution () {\n    return `${this.video.nativeElement.videoWidth} x ${this.video.nativeElement.videoHeight}`\n  }\n  get videoDuration () {\n    return this.video.nativeElement.duration.toFixed(6)\n  }\n  get videoCurrentTime () {\n    return this.video.nativeElement.currentTime.toFixed(6)\n  }\n\n  private timeUpdate: Subscription\n  private controlHoveredChange: Subscription\n  private subscriptions: Subscription[] = []\n\n  t = this.service.i18n.t\n\n  static mapSpeedToProgress (speed) {\n    if (speed < .5) return 0\n    else if (speed < 1.5) return (speed - .5) * 80\n    else if (speed < 2.0) return 80 + (speed - 1.5) * 40\n    else return 100\n  }\n  static mapProgressToSpeed (progress) {\n    if (progress < .1) return .5\n    else if (progress < .9) return .75 + .25 * Math.floor((progress - 0.1) * 5)\n    else return 2\n  }\n\n  static formatDuration (duration: number) {\n    const h = Math.floor(duration / 3600)\n    const m = Math.floor(duration % 3600 / 60)\n    const s = Math.floor(duration % 60)\n    let str = ''\n    if (h && h < 10) { str += `0${h}:` } else if (h) { str += `${h}:` }\n    if (m < 10) { str += `0${m}:` } else { str += `${m}:` }\n    if (s < 10) { str += `0${s}` } else { str += `${s}` }\n    return str\n  }\n\n  constructor (\n    private element: ElementRef,\n    private zone: NgZone,\n    private changeDetectorRef: ChangeDetectorRef,\n    private sanitization: DomSanitizer,\n    private service: UshioService\n  ) {\n    this.showLangMenu = this.showLangMenu.bind(this)\n    this.onComponentClicked = this.onComponentClicked.bind(this)\n    this.onDocumentClicked = this.onDocumentClicked.bind(this)\n  }\n\n  ngOnInit () {\n    this.mPaused = this.video.nativeElement.paused\n    this.mVolume = this.video.nativeElement.volume\n    this.mPlaybackRate = this.video.nativeElement.playbackRate\n  }\n\n  ngAfterContentInit () {\n    const mapPropsToObject = (props: string[], fn) => (sourceObj: any) => (\n      props.reduce((agg, cur) => ({ ...agg, [cur]: fn(sourceObj, cur) }), {})\n    )\n    const onContentChildrenOrSlotChanged$ = (\n      attr, contentChildren:\n      QueryList<any>,\n      slotChange$: Observable<HTMLElement[]>\n    ) => {\n      const contentChildrenMap = mapPropsToObject(attr, (obj, cur) => (obj[cur]))\n      const slotMap = mapPropsToObject(attr, (obj, cur) => (obj.getAttribute(cur)))\n      return merge(\n        of(contentChildren.toArray().map(contentChildrenMap)),\n        contentChildren.changes.pipe(\n          map((contents: QueryList<any>) => (contents.toArray().map(contentChildrenMap)))\n        ),\n        slotChange$.pipe(\n          map((contents: HTMLElement[]) => (\n            contents.map(slotMap)\n          ))\n        )\n      )\n    }\n    const subtitlesAttr = ['value', 'type', 'src', 'name', 'class', 'default', 'srclang']\n    const subtitlesChange$ = onContentChildrenOrSlotChanged$(\n      subtitlesAttr, this.subtitlesContentChildren, this.subtitlesSlotChange$)\n    const sourcesAttr = ['src', 'type', 'name', 'shortname', 'default']\n    const sourcesChange$ = onContentChildrenOrSlotChanged$(\n      sourcesAttr, this.sourceContentChildren, this.sourcesSlotChange$)\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(subtitlesChange$.subscribe(async (subtitles) => {\n        this.mSubtitles = subtitles\n        await this.updateSubtitles()\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(sourcesChange$.subscribe((sources) => {\n        this.mSources = sources\n        this.updateSources()\n        this.changeDetectorRef.detectChanges()\n      }))\n    })\n  }\n\n  ngAfterViewInit () {\n    const mouseMove$ = fromEvent(document, 'mousemove')\n    const mouseUp$ = fromEvent(document, 'mouseup')\n    const touchMove$ = fromEvent(document, 'touchmove')\n    const touchStart$ = fromEvent(document, 'touchstart')\n    const touchEnd$ = merge(\n      fromEvent(document, 'touchend'),\n      fromEvent(document, 'touchcancel')\n    )\n    const mouseTouchUp$ = merge(mouseUp$, touchEnd$)\n    touchStart$.subscribe(() => {\n      this.interactMode = 'mobile'\n    })\n    const ifMouseInArea = (e: MouseEvent, btnElement, popUpElement) => {\n      const rect1 = popUpElement.getBoundingClientRect()\n      const rect2 = btnElement.getBoundingClientRect()\n      return (e.clientX > rect1.left &&\n        e.clientX < rect1.right &&\n        e.clientY > rect1.top &&\n        e.clientY < rect1.bottom) || (e.clientX > rect2.left &&\n        e.clientX < rect2.right &&\n        e.clientY > rect2.top &&\n        e.clientY < rect2.bottom)\n    }\n    const onControlBtnHoverStateChanged$ = (btns) => {\n      return mouseMove$.pipe(\n        switchMap((e: MouseEvent) => {\n          for (const btn of btns) {\n            if (ifMouseInArea(e, btn.btnElement, btn.popUpElement)) {\n              return of(` btn-${btn.btnName}-hover`)\n            }\n          }\n          return timer(150).pipe(\n            mapTo('')\n          )\n        }),\n        distinctUntilChanged()\n      )\n    }\n    const desktopShowControlStateChange$ = mouseMove$.pipe(\n      filter(() => (this.interactMode === 'desktop')),\n      map((e: MouseEvent) => {\n        const rect = this.video.nativeElement.getBoundingClientRect()\n        return {\n          showControl: e.clientX > rect.left &&\n            e.clientX < rect.right &&\n            e.clientY > rect.top &&\n            e.clientY < rect.bottom,\n          delaySwitch: e.clientY < rect.bottom - 46\n        }\n      })\n    )\n    const showControlStateChange$ = merge(\n      desktopShowControlStateChange$,\n      this.mobileShowControlStateChange$\n    ).pipe(\n      switchMap(e => {\n        return e.showControl\n          ? merge(\n            of({\n              showControl: true,\n              noCursor: false\n            }),\n            e.delaySwitch ? timer(\n              this.interactMode === 'desktop' ? 750 : 5000\n            ).pipe(\n              mapTo({\n                showControl: false,\n                noCursor: true\n              })\n            ) : NEVER\n          )\n          : of({\n            showControl: false,\n            noCursor: false\n          })\n      }),\n      distinctUntilChanged((a, b) => (\n        a.showControl === b.showControl && a.noCursor === b.noCursor\n      ))\n    )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(showControlStateChange$.subscribe(state => {\n        this.mShowControl = state.showControl\n        this.mNoCursor = state.noCursor\n        this.changeDetectorRef.detectChanges()\n      }))\n    })\n    const mouseHoverProgressState$ = mouseMove$.pipe(\n      filter(() => (this.interactMode === 'desktop')),\n      map((e: MouseEvent) => {\n        const rect = this.slider.nativeElement.getBoundingClientRect()\n        const yCenter = (rect.top + rect.bottom) / 2\n        if (Math.abs(e.clientY - yCenter) < 8 && e.clientX > rect.left && e.clientX < rect.right) {\n          const left = e.clientX - rect.left\n          const containerLeft = left < 80 ? 90 - left : left > rect.width - 80 ? rect.width - left - 70 : 10\n          const timeLeft = left < 20 ? 30 - left : left > rect.width - 20 ? rect.width - left - 10 : 10\n          return { left, containerLeft, timeLeft, width: rect.width }\n        } else {\n          return false\n        }\n      }),\n      distinctUntilChanged((a, b) => {\n        if (typeof a !== typeof b) {\n          return false\n        } else if (typeof a === 'object' && typeof b === 'object') {\n          return a.left === b.left && a.containerLeft === b.containerLeft\n            && a.timeLeft === b.timeLeft && a.width === b.width\n        } else {\n          return a === b\n        }\n      })\n    )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(mouseHoverProgressState$.subscribe(state => {\n        if (typeof state === 'boolean') {\n          this.showProgressDetail = state\n        } else {\n          this.showProgressDetail = true\n          this.mProgressDetailPosition = `left: ${state.left}px`\n          this.mProgressDetailContainerPosition = `left: ${state.containerLeft}px`\n          this.mProgressDetailTimePosition = `left: ${state.timeLeft}px`\n          this.mProgressDetailPositionRate = state.left / state.width\n        }\n        this.changeDetectorRef.detectChanges()\n      }))\n    })\n    if (this.mPaused) this.video.nativeElement.pause()\n    else this.video.nativeElement.play()\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'pause')\n      .subscribe(() => {\n        this.mPaused = true\n        this.pausedChange.emit(true)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'play')\n      .subscribe(() => {\n        this.mPaused = false\n        this.pausedChange.emit(false)\n      }))\n    const subscribeTimeUpdate = () => {\n      this.zone.runOutsideAngular(() => {\n        this.timeUpdate = fromEvent(this.video.nativeElement, 'timeupdate')\n          .subscribe(() => {\n            this.mCurrentTime = this.video.nativeElement.currentTime\n            this.currentTimeChange.emit(this.mCurrentTime)\n            this.updateFlyingSubtitles(this.mCurrentTime)\n            this.changeDetectorRef.detectChanges()\n          })\n      })\n    }\n    subscribeTimeUpdate()\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'waiting')\n      .subscribe(() => {\n        this.waiting = true\n        this.waitingChange.emit(this.waiting)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'playing')\n      .subscribe(() => {\n        this.waiting = false\n        this.waitingChange.emit(this.waiting)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'progress')\n      .subscribe(() => {\n        this.bufferedTime = ((timeRanges, currentTime) => {\n          const length = timeRanges.length\n          for (let i = 0; i < length; i++) {\n            if (timeRanges.end(i) <= currentTime) {\n              continue\n            }\n            if (timeRanges.start(i) <= currentTime) {\n              return timeRanges.end(i)\n            }\n            return currentTime\n          }\n          return currentTime\n        })(this.video.nativeElement.buffered, this.video.nativeElement.currentTime)\n      }))\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'loadedmetadata')\n      .subscribe(() => {\n        this.duration = this.video.nativeElement.duration\n        this.durationChange.emit(this.duration)\n      }))\n    this.video.nativeElement.volume = this.mVolume\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'volumechange')\n      .subscribe(() => {\n        this.mVolume = this.video.nativeElement.volume\n        this.volumeChange.emit(this.mVolume)\n      }))\n    this.video.nativeElement.playbackRate = this.mPlaybackRate\n    this.subscriptions.push(fromEvent(this.video.nativeElement, 'ratechange')\n      .subscribe(() => {\n        this.mPlaybackRate = this.video.nativeElement.playbackRate\n        this.playbackRateChange.emit(this.mPlaybackRate)\n      }))\n    const mapToRate = (element, progress, total) => map(\n      (moveEvent: MouseEvent | TouchEvent) => {\n        const eventCoordinate = moveEvent instanceof TouchEvent\n          ? moveEvent.changedTouches[0]\n          : moveEvent\n        const rect = element.getBoundingClientRect()\n        let p = progress(eventCoordinate, rect)\n        const t = total(rect)\n        if (p < 0) p = 0\n        else if (p > t) p = t\n        return p / t\n      }\n    )\n    const onMouseTouchDown$ = (element, progress, total) => {\n      return merge(\n        fromEvent(element, 'mousedown'),\n        fromEvent(element, 'touchstart')\n      ).pipe(\n        mapToRate(element, progress, total)\n      )\n    }\n    const onMouseTouchDrag$ = (element, progress, total) => {\n      return merge(\n        fromEvent(element, 'mousedown').pipe(\n          mapToRate(element, progress, total),\n          concatMap(() => {\n            return mouseMove$.pipe(\n              takeUntil(mouseUp$),\n              mapToRate(element, progress, total)\n            )\n          })\n        ),\n        fromEvent(element, 'touchstart').pipe(\n          mapToRate(element, progress, total),\n          concatMap(() => {\n            return touchMove$.pipe(\n              takeUntil(touchEnd$),\n              mapToRate(element, progress, total)\n            )\n          })\n        )\n      )\n    }\n    const thumbMouseTouchDown$ = onMouseTouchDown$(\n      this.slider.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    const thumbTouchDrag$ = onMouseTouchDrag$(\n      this.slider.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(thumbMouseTouchDown$.subscribe(e => {\n        this.thumbMouseDown = true\n        this.timeUpdate.unsubscribe()\n        this.mCurrentTime = e * this.duration\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(thumbTouchDrag$.subscribe(e => {\n        this.mCurrentTime = e * this.duration\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(mouseTouchUp$.subscribe(() => {\n        if (this.thumbMouseDown) {\n          this.video.nativeElement.currentTime = this.mCurrentTime\n          subscribeTimeUpdate()\n          this.thumbMouseDown = false\n          this.changeDetectorRef.detectChanges()\n        }\n      }))\n    })\n    const controlHoverStateChange$ = onControlBtnHoverStateChanged$([{\n      btnElement: this.volumeBtn.nativeElement,\n      popUpElement: this.volumePanel.nativeElement,\n      btnName: 'volume'\n    }, {\n      btnElement: this.settingsBtn.nativeElement,\n      popUpElement: this.settingsPanel.nativeElement,\n      btnName: 'settings'\n    }, {\n      btnElement: this.sourceBtn.nativeElement,\n      popUpElement: this.sourcePanel.nativeElement,\n      btnName: 'source'\n    }, {\n      btnElement: this.subtitlesBtn.nativeElement,\n      popUpElement: this.subtitlesPanel.nativeElement,\n      btnName: 'subtitles'\n    }])\n    const subscribeControlHoveredChange = () => {\n      this.zone.runOutsideAngular(() => {\n        this.controlHoveredChange = controlHoverStateChange$.subscribe(e => {\n          this.controlHoveredClass = e\n          this.setAllControlPanelsPosition()\n          this.changeDetectorRef.detectChanges()\n        })\n      })\n    }\n    subscribeControlHoveredChange()\n    const hoverStateChange$ = merge(showControlStateChange$, controlHoverStateChange$).pipe(\n      map(() => this.showControl),\n      distinctUntilChanged()\n    )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(hoverStateChange$.subscribe(e => {\n        this.showControlChange.emit(e)\n      }))\n    })\n    const volumeMouseTouchDown$ = onMouseTouchDown$(\n      this.volumeBar.nativeElement,\n      (moveEvent, rect) => (rect.bottom - moveEvent.clientY),\n      (rect) => (rect.height)\n    )\n    const volumeTouchDrag$ = onMouseTouchDrag$(\n      this.volumeBar.nativeElement,\n      (moveEvent, rect) => (rect.bottom - moveEvent.clientY),\n      (rect) => (rect.height)\n    )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(volumeMouseTouchDown$.subscribe(e => {\n        if (!this.controlMouseDown) {\n          this.controlMouseDown = true\n          this.controlHoveredChange.unsubscribe()\n        }\n        this.video.nativeElement.muted = false\n        this.video.nativeElement.volume = e\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(volumeTouchDrag$.subscribe(e => {\n        this.video.nativeElement.volume = e\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(mouseTouchUp$.subscribe(() => {\n        if (this.controlMouseDown) {\n          subscribeControlHoveredChange()\n          this.controlMouseDown = false\n          this.changeDetectorRef.detectChanges()\n        }\n      }))\n    })\n    const speedMouseTouchDown$ = onMouseTouchDown$(\n      this.speedBar.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    const speedTouchDrag$ = onMouseTouchDrag$(\n      this.speedBar.nativeElement,\n      (moveEvent, rect) => (moveEvent.clientX - rect.left),\n      (rect) => (rect.width)\n    )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(speedMouseTouchDown$.subscribe(e => {\n        if (!this.controlMouseDown) {\n          this.controlMouseDown = true\n          this.controlHoveredChange.unsubscribe()\n        }\n        this.video.nativeElement.playbackRate = UshioComponent.mapProgressToSpeed(e)\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(speedTouchDrag$.subscribe(e => {\n        this.video.nativeElement.playbackRate = UshioComponent.mapProgressToSpeed(e)\n        this.changeDetectorRef.detectChanges()\n      }))\n    })\n    const onKeyDown$ = code => fromEvent(document, 'keydown').pipe(\n      filter((e: KeyboardEvent) => this.focus && e.code === code),\n      tap(e => {\n        e.preventDefault()\n        e.stopPropagation()\n      })\n    )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(onKeyDown$('Space').subscribe(e => {\n        this.togglePlay()\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(onKeyDown$('ArrowRight').subscribe(() => {\n        this.mCurrentTime = this.mCurrentTime + 5 < this.duration ? this.mCurrentTime + 5 : this.duration\n        this.video.nativeElement.currentTime = this.mCurrentTime\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(onKeyDown$('ArrowLeft').subscribe(() => {\n        this.mCurrentTime = this.mCurrentTime - 5 > 0 ? this.mCurrentTime - 5 : 0\n        this.video.nativeElement.currentTime = this.mCurrentTime\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(onKeyDown$('ArrowUp').subscribe(() => {\n        this.mVolume = this.mVolume + 0.1 < 0.999996 ? this.mVolume + 0.1 : 1\n        this.video.nativeElement.volume = this.mVolume\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.subscriptions.push(onKeyDown$('ArrowDown').subscribe(() => {\n        this.mVolume = this.mVolume - 0.1 > 0.000004 ? this.mVolume - 0.1 : 0\n        this.video.nativeElement.volume = this.mVolume\n        this.changeDetectorRef.detectChanges()\n      }))\n    })\n    const showVolumeHint$ = merge(onKeyDown$('ArrowUp'), onKeyDown$('ArrowDown'))\n      .pipe(\n        switchMap(\n          () => merge(of(true), timer(1000).pipe(mapTo(false)))\n        ),\n        distinctUntilChanged()\n      )\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(showVolumeHint$.subscribe(e => {\n        this.showVolumeHint = e\n        this.changeDetectorRef.detectChanges()\n      }))\n      this.setAllControlPanelsPosition()\n    })\n    this.subscriptions.push(fromEvent(this.element.nativeElement, 'contextmenu')\n      .subscribe((e: MouseEvent) => {\n        e.preventDefault()\n        const outer = this.element.nativeElement.getBoundingClientRect()\n        const panel = this.contextMenu.nativeElement.getBoundingClientRect()\n        if (e.clientX + panel.width + 20 > outer.right) {\n          if (e.clientY + panel.height + 20 > outer.bottom) {\n            this.mContextMenuPosition = `right: ${outer.right - e.clientX}px; bottom: ${outer.bottom - e.clientY}px`\n          } else {\n            this.mContextMenuPosition = `right: ${outer.right - e.clientX}px; top: ${e.clientY - outer.top}px`\n          }\n        } else {\n          if (e.clientY + panel.height + 20 > outer.bottom) {\n            this.mContextMenuPosition = `left: ${e.clientX - outer.left}px; bottom: ${outer.bottom - e.clientY}px`\n          } else {\n            this.mContextMenuPosition = `left: ${e.clientX - outer.left}px; top: ${e.clientY - outer.top}px`\n          }\n        }\n        this.contextMenuState = 'root'\n        this.showContextMenu = true\n      }))\n    this.zone.runOutsideAngular(() => {\n      this.langContextMenuOption.nativeElement.addEventListener('click', this.showLangMenu, true)\n      this.element.nativeElement.addEventListener('click', this.onComponentClicked, true)\n      document.addEventListener('click', this.onDocumentClicked, true)\n    })\n    const animationFrame$ = of(null, animationFrameScheduler).pipe(repeat())\n    this.zone.runOutsideAngular(() => {\n      this.subscriptions.push(animationFrame$.subscribe(() => {\n        if (!this.fpsStart) this.fpsStart = +new Date()\n        this.fpsIndex++\n        const fpsCurrent = +new Date()\n        if (fpsCurrent - this.fpsStart > 1000) {\n          this.fps = ((this.fpsIndex / (fpsCurrent - this.fpsStart)) * 1000).toFixed(2)\n          this.fpsStart = +new Date()\n          this.fpsIndex = 0\n          this.changeDetectorRef.detectChanges()\n        }\n      }))\n    })\n  }\n\n  ngOnDestroy () {\n    if (this.timeUpdate) this.timeUpdate.unsubscribe()\n    if (this.controlHoveredChange) this.controlHoveredChange.unsubscribe()\n    this.subscriptions.forEach(sub => sub.unsubscribe())\n    this.langContextMenuOption.nativeElement.removeEventListener('click', this.showLangMenu, true)\n    this.element.nativeElement.removeEventListener('click', this.onComponentClicked, true)\n    document.removeEventListener('click', this.onDocumentClicked, true)\n  }\n\n  private updateSources () {\n    if (this.mSources.length === 0) {\n      this.sources = [{\n        shortName: 'Default',\n        name: 'Default',\n        default: true,\n        sources: [{ src: this.mSrc, type: undefined }]\n      }]\n    } else {\n      const sm = {}\n      this.mSources.forEach(source => {\n        if (!source.shortname) {\n          source.shortname = 'Untitled'\n        }\n        if (!sm[source.shortname]) {\n          sm[source.shortname] = {\n            shortName: source.shortname,\n            name: source.name || 'Untitled',\n            sources: []\n          }\n        }\n        sm[source.shortname].sources.push(source)\n        if (source.default !== undefined && source.default !== null) {\n          sm[source.shortname].default = true\n        }\n      })\n      this.sources = Object.values(sm)\n    }\n    const indexOfDefault = this.sources.findIndex(s => s.default)\n    this.playingSource = indexOfDefault >= 0 ? indexOfDefault : 0\n  }\n\n  private async updateSubtitles () {\n    const parsedSubtitles = []\n    for (const sub of this.mSubtitles) {\n      let text = ''\n      if (sub.value) text = sub.value\n      else if (sub.src) {\n        const resp = await fetch(sub.src)\n        text = await resp.text()\n      }\n      const parsed = {\n        name: sub.name || 'Untitled',\n        class: sub.class || '',\n        parsedSubtitles: undefined,\n        enabled: sub.default !== undefined && sub.default !== null\n          || sub.srclang === this.service.i18n.language\n      }\n      sub.type = sub.type || ''\n      sub.type = sub.type.toLowerCase()\n      if (sub.type !== 'text/vtt' && sub.type !== 'application/x-subrip') {\n        console.warn('Unknown MIME type of subtitles, trying to infer subtitle format. Supported type: text/vtt, application/x-subrip.')\n      }\n      try {\n        parsed.parsedSubtitles = this.service.parseSubtitles(text)\n      } catch (e) {\n        console.error(e)\n      }\n      parsedSubtitles.push(parsed)\n    }\n    this.subtitles = parsedSubtitles\n    this.updateFlyingSubtitles()\n  }\n\n  private updateFlyingSubtitles (currentTime?) {\n    if (currentTime === undefined) {\n      currentTime = this.video.nativeElement.currentTime\n    }\n    currentTime *= 1000\n    const flyingSubtitles = []\n    this.enabledSubtitles.forEach(subtitles => {\n      if (!subtitles.parsedSubtitles) return\n      const flyingSubtitlesTrack = []\n      subtitles.parsedSubtitles.forEach(subtitle => {\n        if (currentTime > subtitle.startTime && currentTime < subtitle.endTime) {\n          flyingSubtitlesTrack.push({\n            ...subtitle,\n            texts: subtitle.texts.map(text => this.sanitization.bypassSecurityTrustHtml(text))\n          })\n        }\n      })\n      if (flyingSubtitlesTrack.length) {\n        flyingSubtitles.push({\n          name: subtitles.name,\n          class: subtitles.class,\n          parsedSubtitles: flyingSubtitlesTrack\n        })\n      }\n    })\n    this.flyingSubtitles = flyingSubtitles\n  }\n\n  private setAllControlPanelsPosition () {\n    setTimeout(() => {\n      [{\n        btn: this.settingsBtn,\n        panel: this.settingsPanel,\n        name: 'settings'\n      }, {\n        btn: this.sourceBtn,\n        panel: this.sourcePanel,\n        name: 'source'\n      }, {\n        btn: this.subtitlesBtn,\n        panel: this.subtitlesPanel,\n        name: 'subtitles'\n      }, {\n        btn: this.loopBtn,\n        panel: this.loopPanel,\n        name: 'loop'\n      }, {\n        btn: this.fullScreenBtn,\n        panel: this.fullScreenPanel,\n        name: 'fullscreen'\n      }].forEach(item => this.setPanelPosition(item.btn, item.panel, item.name))\n      this.changeDetectorRef.detectChanges()\n    }, 0)\n  }\n\n  private setPanelPosition (btn, panel, name) {\n    if (!this.element || !panel || !btn) return\n    const outerRect = this.element.nativeElement.getBoundingClientRect()\n    const panelRect = panel.nativeElement.getBoundingClientRect()\n    const btnRect = btn.nativeElement.getBoundingClientRect()\n    if (panelRect.width / 2 - outerRect.right + btnRect.right > 0) {\n      this.panelTranslations[name] = panelRect.width / 2 - outerRect.right + btnRect.right\n    } else {\n      this.panelTranslations[name] = 0\n    }\n  }\n\n  onSlotChange (e) {\n    this.subtitlesSlotUpdate$.next(\n      e.target.assignedNodes().filter(node => node.nodeName === 'USHIO-SUBTITLES')\n    )\n    this.sourcesSlotUpdate$.next(\n      e.target.assignedNodes().filter(node => node.nodeName === 'USHIO-SOURCE')\n    )\n    this.mInjectedStyles = e.target.assignedNodes()\n      .filter(node => node.nodeName === 'STYLE').map(node => node.innerHTML)\n  }\n\n  onVideoMaskClicked () {\n    if (this.interactMode === 'desktop') {\n      this.togglePlay()\n    } else {\n      this.mobileShowControlStateChange$.next({\n        showControl: !this.mShowControl,\n        delaySwitch: true\n      })\n    }\n  }\n\n  onSelectSource (i) {\n    if (i === this.playingSource) return\n    const currentTime = this.mCurrentTime\n    const paused = this.mPaused\n    this.playingSource = i\n    this.video.nativeElement.load()\n    this.video.nativeElement.currentTime = currentTime\n    if (!paused) this.video.nativeElement.play()\n  }\n\n  onCheckSubtitles (i) {\n    this.subtitles[i].enabled = !this.subtitles[i].enabled\n    this.updateFlyingSubtitles()\n  }\n\n  togglePlay () {\n    if (this.video.nativeElement.paused) this.video.nativeElement.play()\n    else this.video.nativeElement.pause()\n  }\n\n  toggleMute () {\n    if (this.interactMode === 'desktop') {\n      this.video.nativeElement.muted = !(this.video.nativeElement.muted || this.video.nativeElement.volume === 0)\n      this.mutedChange.emit(this.video.nativeElement.muted)\n    } else if (this.video.nativeElement.muted) {\n      this.video.nativeElement.muted = false\n      this.mutedChange.emit(false)\n    }\n    if (!this.video.nativeElement.muted && this.video.nativeElement.volume === 0) {\n      this.video.nativeElement.volume = Math.random()\n    }\n  }\n\n  toggleLoop () {\n    this.video.nativeElement.loop = !this.video.nativeElement.loop\n    this.loopChange.emit(this.video.nativeElement.loop)\n  }\n\n  toggleFullscreen () {\n    if (!this.isFullScreen) {\n      this.element.nativeElement.requestFullscreen()\n    } else {\n      document.exitFullscreen()\n    }\n  }\n\n  showLangMenu () {\n    this.contextMenuState = 'lang'\n    this.showContextMenu = true\n    this.changeDetectorRef.detectChanges()\n  }\n\n  onComponentClicked () {\n    this.focus = true\n  }\n\n  onDocumentClicked () {\n    this.focus = false\n    if (this.showContextMenu) {\n      this.showContextMenu = false\n      this.changeDetectorRef.detectChanges()\n    }\n  }\n\n  setLanguage (code) {\n    this.service.i18n.setLanguage(code)\n  }\n\n  toggleShowStatisticInfoPanel () {\n    this.showStatisticInfoPanel = !this.showStatisticInfoPanel\n  }\n\n}\n","import { CommonModule } from '@angular/common'\nimport { NgModule } from '@angular/core'\n\nimport { UshioComponent, UshioSource, UshioSubtitles } from './ushio.component'\n\n@NgModule({\n  declarations: [\n    UshioComponent,\n    UshioSource,\n    UshioSubtitles\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    UshioComponent,\n    UshioSource,\n    UshioSubtitles\n  ]\n})\nexport class UshioModule { }\n"]}